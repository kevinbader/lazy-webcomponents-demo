# Web Components Demo with Angular Elements

- [Steps to do this yourself](#steps-to-do-this-yourself)
  - [Create a web component](#create-a-web-component)
  - [In the host project](#in-the-host-project)

`ask-user` is a simple web component that consists of a button and a pretty ugly form. `demo-website` embeds this components by lazy-loading it from a hard-coded URL.

You can test embedding the `ask-user` component in your own website right now! It's available at [https://kevinbader.github.io/lazy-webcomponents-demo/main-es2015.js](https://kevinbader.github.io/lazy-webcomponents-demo/main-es2015.js).

## Steps to do this yourself

### Create a web component

Create a new project:

```bash
ng new my-first-component
cd my-first-component
```

We need `@angular/elements` for registering the Angular component as a web component using `createCustomElement`:

```bash
ng add @angular/elements
```

Create a new component:

```bash
ng generate component my-button
```

Add this component to `entryComponents` in `app.module.ts`. The `ngDoBootstrap` callback is used to define the web component and `bootstrap` must be empty.

```typescript
import { Injector } from '@angular/core';
import { createCustomElement } from '@angular/elements';

@NgModule({
   imports: [BrowserModule],
   declarations: [MyButton],
   entryComponents: [MyButton],
   bootstrap: []
})
export class AppModule {
    constructor(private injector: Injector) { }
    ngDoBootstrap() {
        customElements.define('my-button', createCustomElement(MyButton, { injector: this.injector }));
    }
}
```

The default build tool cannot create a single-file JavaScript bundle, so we augment it using `ngx-build-plus`:

```bash
ng add ngx-build-plus
ng build --prod --single-bundle --output-hashing none
```

When serving the files, make sure caching is set up corrently and etags are used. To try this locally, use something like `serve` to serve the files:

```bash
npm i -g serve
cd dist/my-first-component
serve -C -p 5000
```

### In the host project

Install polyfills:

```bash
# Either:
ng add @angular/elements
# Or:
ng add ngx-build-plus && ng g ngx-build-plus:wc-polyfill
```

This enables the lazy-loading directive:

```bash
npm i -S @angular-extensions/elements
```

In `app.module.ts`:

```typescript
import { CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';
import { LazyElementsModule } from '@angular-extensions/elements';

@NgModule({
  // ...,
  imports: [..., LazyElementsModule],
  schemas: [CUSTOM_ELEMENTS_SCHEMA]
})
export class AppModule { }
```

In the component that uses the `my-button` web component:

```typescript
@Component({...})
export class MyComponent {
  myButtonUrl = 'http://localhost:5000/main-es2015.js';
  // ...
}
```

And in its template:

```html
<ng-template #loading>Loading...</ng-template>
<ng-template #error><p>Failed to load web component!</p></ng-template>
<my-button
  *axLazyElement="myButtonUrl; loadingTemplate: loading; errorTemplate: error"
  label="the button label"
  (click)="onButtonClick($event)"
></my-button>
```

Events generated by the web component look like any other DOM event. If you pass an object to `emit` in the component, use the event's `detail` property to access it in the parent component:

```typescript
class MyParentComponent {
  // ...

  onComponentEvent(event) {
    const payload = event.detail;
    // ...
  }
}
```
